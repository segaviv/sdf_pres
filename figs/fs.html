<html><body style="height:100%;width:100%;justify-content:center;display:flex"> <div id="uniform_editor" style="display:none;position:absolute;right:20px"> </div> <div style="height:100%;width:95%;display:flex"> <div style="height:100%;flex:auto;margin-right:20px"> <canvas style="height:100%;width:100%" id="canvas" class="canvas"> </canvas> </div> <div id="code" style="height:100%;width:50%"> <textarea rows="50" id="textarea" style="height:100%;width:100%">
      </textarea> </div> </div> </body><script>const autoUniformRegex=/\/\*\s*([a-z\d]+)\s*\*\/\s*([a-zA-Z\d]+)/g,codeElem=document.getElementById("code"),uniformEditor=document.getElementById("uniform_editor"),FLOAT_PRECISION="precision highp float;",vsSource="attribute vec4 aVertexPosition; void main(){gl_Position = aVertexPosition;}",fsSource="\n    uniform vec2 res;\n\n    void main() {\n      vec2 p = gl_FragCoord.xy - res / 2.;\n\n      gl_FragColor = vec4(1.0);\n    }\n  ",AUTO_COMPILE_DELAY_MS=100,canvas=document.getElementById("canvas");canvas.width=canvas.clientWidth,canvas.height=canvas.clientHeight;const gl=canvas.getContext("webgl"),input=document.getElementById("textarea");input.value=fsSource;let bAutoCompile=!1,gShaderProgram=null,gBuffers=null,triggerCompilerTimeout=null,compilePromise=null,gUniforms=new Map;function initBuffers(e){const r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);return e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW),{position:r}}function initShaderProgram(e,r,t){const o=loadShader(e,e.VERTEX_SHADER,r);if(null==o)return null;const n=loadShader(e,e.FRAGMENT_SHADER,t);if(null==n)return e.deleteShader(o),null;const i=e.createProgram();return e.attachShader(i,o),e.attachShader(i,n),e.linkProgram(i),e.deleteShader(o),e.deleteShader(n),e.getProgramParameter(i,e.LINK_STATUS)?i:(console.log("Unable to initialize the shader program: "+e.getProgramInfoLog(i)),e.deleteProgram(i),null)}function loadShader(e,r,t){const o=e.createShader(r);return e.shaderSource(o,t),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)?o:(console.log("An error occurred compiling the shaders: "+e.getShaderInfoLog(o)),e.deleteShader(o),null)}function drawScene(e,r,t,o){r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT);{const e=2,n=r.FLOAT,i=!1,a=0,l=0;r.bindBuffer(r.ARRAY_BUFFER,o.position),r.vertexAttribPointer(t.attribLocations.vertexPosition,e,n,i,a,l),r.enableVertexAttribArray(t.attribLocations.vertexPosition)}r.useProgram(t.program),r.uniform2f(t.uniformLocations.res,e.width,e.height);{const e=0,t=4;r.drawArrays(r.TRIANGLE_STRIP,e,t)}}function init(){gBuffers=initBuffers(gl),compilePromise=compile()}function defaultValueForType(e){switch(e){case"int":case"float":return 0;case"vec2":return[0,0];case"vec3":return[0,0,0];case"vec4":return[0,0,0,0]}return""}function extractUniforms(){const e=[...input.value.matchAll(autoUniformRegex)],r=new Set(e.map((e=>e[2])));[...gUniforms.keys()].filter((e=>!r.has(e))).forEach((e=>gUniforms.delete(e))),e.forEach((e=>{gUniforms.has(e)&&gUniforms.get(e).type==e[1]||gUniforms.set(e[2],{type:e[1],value:defaultValueForType(e[1])})}))}function getUniformString(){extractUniforms();let e="";return gUniforms.forEach(((r,t)=>{e+=`uniform ${r.type} ${t};`})),e}async function compile(){const e=new Promise(((e,r)=>{const t=FLOAT_PRECISION+getUniformString()+input.value,o=initShaderProgram(gl,vsSource,t);o||r(),e(o)}));return e.then((e=>{compilePromise=null,gl.deleteProgram(gShaderProgram),gShaderProgram=e;const r={program:gShaderProgram,attribLocations:{vertexPosition:gl.getAttribLocation(gShaderProgram,"aVertexPosition")},uniformLocations:{res:gl.getUniformLocation(gShaderProgram,"res")}};drawScene(canvas,gl,r,gBuffers)})),e}init(),input.oninput=()=>{bAutoCompile&&(triggerCompilerTimeout&&clearTimeout(triggerCompilerTimeout),setTimeout((()=>{compilePromise=compile()}),100))},window.addEventListener("keydown",(e=>{"Backquote"==e.code?"none"==codeElem.style.display?codeElem.style.display="":codeElem.style.display="none":"Enter"==e.code&&e.ctrlKey&&(compilePromise=compile())}));</script></html>