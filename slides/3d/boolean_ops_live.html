<!DOCTYPE html><html style="height:100%;width:100%;background-color:#fff"><script src="https://segaviv.github.io/sdf_pres/slides/3d/boolean_ops_live.63dbaaf1.js"></script><script src="https://segaviv.github.io/sdf_pres/slides/3d/boolean_ops_live.795393b1.js"></script><link rel="stylesheet" href="https://segaviv.github.io/sdf_pres/slides/3d/boolean_ops_live.d1b9ff40.css"><link rel="stylesheet" href="https://segaviv.github.io/sdf_pres/slides/3d/boolean_ops_live.38e91f2d.css"><script src="https://segaviv.github.io/sdf_pres/slides/3d/boolean_ops_live.da5b651f.js"></script><script src="https://segaviv.github.io/sdf_pres/slides/3d/boolean_ops_live.33ce1ede.js"></script><script src="https://segaviv.github.io/sdf_pres/slides/3d/boolean_ops_live.6a192074.js"></script><script src="https://segaviv.github.io/sdf_pres/slides/3d/boolean_ops_live.9a5ff9ea.js"></script><script src="https://segaviv.github.io/sdf_pres/slides/3d/boolean_ops_live.4a4f4a08.js"></script><link rel="stylesheet" href="https://segaviv.github.io/sdf_pres/slides/3d/boolean_ops_live.cfb110c9.css"><link rel="stylesheet" href="https://segaviv.github.io/sdf_pres/slides/3d/boolean_ops_live.fd494ee6.css"><script src="https://segaviv.github.io/sdf_pres/slides/3d/boolean_ops_live.d4381dda.js"></script><link type="text/css" rel="stylesheet" href="https://segaviv.github.io/sdf_pres/slides/3d/boolean_ops_live.9e745220.css"><body style="height:100%;width:100%;justify-content:center;display:flex;overflow:hidden"> <div style="height:100%;width:95%;display:flex"> <div style="height:100%;flex-direction:column;flex:auto;justify-content:center;align-items:center;display:flex"> <canvas style="height:400px;width:400px" id="canvas" class="canvas"> </canvas> <div id="controls" style="width:100%;background-color:#f0f8ff;display:flex"> <div style="display:flex"> <span id="time" contenteditable="" style="margin-left:8px;margin-right:2px"> 0.00</span>s <span id="fps" style="margin-left:20px;margin-right:2px"> 0.0 </span>fps </div> </div> </div> <div id="code" style="height:90%;opacity:.9;align-items:center;margin-left:20px;display:flex;top:5%"> <textarea id="textarea" style="height:100%;width:100%">
      </textarea> </div> </div> <div style="display:block;position:absolute;bottom:0;left:10px;right:10px"> <input id="command" style="width:100%;display:none"> </div> <dialog id="help_dialog" style="background-color:#b8b8b8e0;border-radius:5px"> <div style="flex-direction:column;display:flex"> <h4 style="align-self:center">Help (Esc to close)</h4> <p> This is a mini hacked version of <a href="https://www.shadertoy.com" target="_blank">Shadertoy</a>.<br> It has some tricks to make it easier to fine tune variables, and plenty of shortcuts. </p> <table style="width:100%;background-color:#999"> <tr> <th colspan="4" style="color:#fff;background-color:#333">Shortcuts</th> </tr> <tr style="background-color:#777"> <td>⌘/Alt/Ctrl + Enter</td> <td>Compile</td> <td>⌘/Ctrl + 1</td> <td>Show gui</td> </tr> <tr> <td>⌥/Alt/Ctrl + F</td> <td>Toggle fullscreen</td> <td>⌘/Ctrl + 2</td> <td>Show controls</td> </tr> <tr style="background-color:#777"> <td>⌥/Alt + ↑ </td> <td>Start/Stop time</td> <td>⌥/Alt + ↓ </td> <td>Reset time</td> </tr> <tr> <td>~</td> <td>Show/hide editor</td> <td>Ctrl + ~</td> <td>Command prompt</td> </tr> <tr style="background-color:#777"> <td>⌘/Ctrl + S</td> <td>Quick save</td> <td>⌘/Ctrl + O</td> <td>Quick load</td> </tr> <tr> <td colspan="2">(Select val) ⌘/Ctrl + E</td> <td colspan="2">Extract uniform</td> </tr> <tr style="background-color:#777"> <td colspan="2">(Select uniform) ⌘/Ctrl + E</td> <td colspan="2">Replace with value</td> </tr> <tr> <td colspan="2">⌘/Alt + canvas click + mouse move</td> <td colspan="2">Resize canvas</td> </tr> <tr style="background-color:#777"> <td colspan="2">canvas click + mouse move</td> <td colspan="2">Control mouse variable</td> </tr> <tr> <td colspan="2">shift + mouse move</td> <td colspan="2">Make it move faster</td> </tr> </table> </div> </dialog> </body><script>const autoUniformRegex=/\/\*\s*([a-z\d]+)\s*\*\/\s*([a-zA-Z\d\_]+)/g,assignmentRegex=/([a-zA-Z\d\_\.]+)\s*\=/g,vec2Vals=/\((\d*\.?\d*)\s*\,\s*(\d*\.?\d*)\)/g,vec3Vals=/\((\d*\.?\d*)\s*\,\s*(\d*\.?\d*)\s*,\s*(\d*\.?\d*)\)/g,vec4Vals=/\((\d*\.?\d*)\s*\,\s*(\d*\.?\d*)\s*,\s*(\d*\.?\d*)\s*,\s*(\d*\.?\d*)\)/g,codeElem=document.getElementById("code"),dialogElement=document.getElementById("help_dialog"),commandElem=document.getElementById("command"),timeElem=document.getElementById("time"),fpsElem=document.getElementById("fps");let lastFpsTimestamp;const FLOAT_PRECISION="#version 300 es\n   precision mediump float;\n    out vec4 fragColor;\n    #define iResolution res\n    #define iFrame 0\n    #define HW_PERFORMANCE 0\n    #define iTime time\n    #define iMouse mouse\n\n    uniform vec2 res;\n    uniform float time;\n    uniform vec2 mouse;\n    ",FRAG_SHARDER_SUFFIX="\n  void main() {\n      vec4 temp;\n      mainImage(temp, gl_FragCoord.xy);\n      fragColor = vec4(temp.xyz, 1.0);\n    }\n  ",magicFuncs={sdCircle:"float sdCircle(vec2 p, float r) {\n      return length(p) - r;\n    }",sdBox:"float sdBox(vec2 p, vec2 b) {\n      vec2 d = abs(p)-b;\n      return length(max(d,0.0)) + min(max(d.x,d.y),0.0);\n    }",smin:"float smin(float a, float b, float k) {\n      float h = max( k-abs(a-b), 0.0 )/k;\n      return min( a, b ) - h*h*k*0.25;\n    }\n    "},vsSource="#version 300 es\n in vec4 aVertexPosition; void main(){gl_Position = aVertexPosition;}",fsSource="\nfloat opUnion( float d1, float d2 )\n{\n    return min(d1,d2);\n}\n\nfloat opSubtraction( float d1, float d2 )\n{\n    return max(-d1,d2);\n}\n\nfloat opIntersection( float d1, float d2 )\n{\n    return max(d1,d2);\n}\n\nfloat opSmoothUnion( float d1, float d2, float k )\n{\n    float h = max(k-abs(d1-d2),0.0);\n    return min(d1, d2) - h*h*0.25/k;\n\t//float h = clamp( 0.5 + 0.5*(d2-d1)/k, 0.0, 1.0 );\n\t//return mix( d2, d1, h ) - k*h*(1.0-h);\n}\n\nfloat opSmoothSubtraction( float d1, float d2, float k )\n{\n    float h = max(k-abs(-d1-d2),0.0);\n    return max(-d1, d2) + h*h*0.25/k;\n\t//float h = clamp( 0.5 - 0.5*(d2+d1)/k, 0.0, 1.0 );\n\t//return mix( d2, -d1, h ) + k*h*(1.0-h);\n}\n\nfloat opSmoothIntersection( float d1, float d2, float k )\n{\n    float h = max(k-abs(d1-d2),0.0);\n    return max(d1, d2) + h*h*0.25/k;\n\t//float h = clamp( 0.5 - 0.5*(d2-d1)/k, 0.0, 1.0 );\n\t//return mix( d2, d1, h ) + k*h*(1.0-h);\n}\n\n//-------------------------------------------------\n\nfloat sdSphere( in vec3 p, in float r )\n{\n    return length(p)-r;\n}\n\n\nfloat sdRoundBox( vec3 p, vec3 b, float r )\n{\n  vec3 d = abs(p) - b;\n  return min(max(d.x,max(d.y,d.z)),0.0) + length(max(d,0.0)) - r;\n}\n\n//---------------------------------\n\nfloat map(in vec3 pos)\n{\n    float d = 1e10;\n    \n    \n    float an = sin(iTime);\n\n    // opUnion\n    {\n    vec3 q = pos - vec3(-2.0,0.0,-1.3);\n    float d1 = sdSphere( q-vec3(0.0,0.5+0.3*an,0.0), 0.55 );\n    float d2 = sdRoundBox(q, vec3(0.6,0.2,0.7), 0.1 ); \n    float dt = opUnion(d1,d2);\n    d = min( d, dt );\n  \t}\n    \n    // opSmoothUnion\n    {\n    vec3 q = pos - vec3(-2.0,0.0,1.0);\n    float d1 = sdSphere( q-vec3(0.0,0.5+0.3*an,0.0), 0.55 );\n    float d2 = sdRoundBox(q, vec3(0.6,0.2,0.7), 0.1 ); \n    float dt = opSmoothUnion(d1,d2, 0.25);\n    d = min( d, dt );\n    }\n\n\n    // opSubtraction\n    {\n    vec3 q = pos - vec3(0.0,0.0,-1.3);\n    float d1 = sdSphere( q-vec3(0.0,0.5+0.3*an,0.0), 0.55 );\n    float d2 = sdRoundBox(q, vec3(0.6,0.2,0.7), 0.1 ); \n    float dt = opSubtraction(d1,d2);\n    d = min( d, dt );\n    }\n\n    // opSmoothSubtraction\n    {\n    vec3 q = pos - vec3(0.0,0.0,1.0);\n    float d1 = sdSphere( q-vec3(0.0,0.5+0.3*an,0.0), 0.55 );\n    float d2 = sdRoundBox(q, vec3(0.6,0.2,0.7), 0.1 ); \n    float dt = opSmoothSubtraction(d1,d2, 0.25);\n    d = min( d, dt );\n    }\n\n    // opIntersection\n    {\n    vec3 q = pos - vec3(2.0,0.0,-1.3);\n    float d1 = sdSphere( q-vec3(0.0,0.5+0.3*an,0.0), 0.55 );\n    float d2 = sdRoundBox(q, vec3(0.6,0.2,0.7), 0.1 ); \n    float dt = opIntersection(d1,d2);\n    d = min( d, dt );\n    }\n    \n    // opSmoothIntersection\n    {\n    vec3 q = pos - vec3(2.0,0.0,1.0);\n    float d1 = sdSphere( q-vec3(0.0,0.5+0.3*an,0.0), 0.55 );\n    float d2 = sdRoundBox(q-vec3(0.0,0.5,0.0), vec3(0.6,0.2,0.7), 0.1 ); \n    float dt = opSmoothIntersection(d1,d2, 0.25);\n    d = min( d, dt );\n    }\n\n    return d;\n}\n\n// https://iquilezles.org/articles/normalsSDF\nvec3 calcNormal( in vec3 pos )\n{\n    const float ep = 0.0001;\n    vec2 e = vec2(1.0,-1.0)*0.5773;\n    return normalize( e.xyy*map( pos + e.xyy*ep ) + \n\t\t\t\t\t  e.yyx*map( pos + e.yyx*ep ) + \n\t\t\t\t\t  e.yxy*map( pos + e.yxy*ep ) + \n\t\t\t\t\t  e.xxx*map( pos + e.xxx*ep ) );\n}\n\n// https://iquilezles.org/articles/rmshadows\nfloat calcSoftshadow( in vec3 ro, in vec3 rd, float tmin, float tmax, const float k )\n{\n\tfloat res = 1.0;\n    float t = tmin;\n    for( int i=0; i<50; i++ )\n    {\n\t\tfloat h = map( ro + rd*t );\n        res = min( res, k*h/t );\n        t += clamp( h, 0.02, 0.20 );\n        if( res<0.005 || t>tmax ) break;\n    }\n    return clamp( res, 0.0, 1.0 );\n}\n\n\n#define AA 2\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n   vec3 tot = vec3(0.0);\n    \n    #if AA>1\n    for( int m=0; m<AA; m++ )\n    for( int n=0; n<AA; n++ )\n    {\n        // pixel coordinates\n        vec2 o = vec2(float(m),float(n)) / float(AA) - 0.5;\n        vec2 p = (-iResolution.xy + 2.0*(fragCoord+o))/iResolution.y;\n        #else    \n        vec2 p = (-iResolution.xy + 2.0*fragCoord)/iResolution.y;\n        #endif\n \n        vec3 ro = vec3(0.0,4.0,8.0);\n        vec3 rd = normalize(vec3(p-vec2(0.0,1.8),-3.5));\n\n        float t = 7.0;\n        for( int i=0; i<64; i++ )\n        {\n            vec3 p = ro + t*rd;\n            float h = map(p);\n            if( abs(h)<0.001 || t>11.0 ) break;\n            t += h;\n        }\n\n        vec3 col = vec3(0.0);\n\n        if( t<11.0 )\n        {\n            vec3 pos = ro + t*rd;\n            vec3 nor = calcNormal(pos);\n            vec3  lig = normalize(vec3(1.0,0.8,-0.2));\n            float dif = clamp(dot(nor,lig),0.0,1.0);\n            float sha = calcSoftshadow( pos, lig, 0.001, 1.0, 16.0 );\n            float amb = 0.5 + 0.5*nor.y;\n            col = vec3(0.05,0.1,0.15)*amb + \n                  vec3(1.00,0.9,0.80)*dif*sha;\n        }\n\n        col = sqrt( col );\n\t    tot += col;\n    #if AA>1\n    }\n    tot /= float(AA*AA);\n    #endif\n\n\tfragColor = vec4( tot, 1.0 );\n}\n  ";var _transitions=[];const AUTO_COMPILE_DELAY_MS=250,canvas=document.getElementById("canvas"),controls=document.getElementById("controls"),gl=canvas.getContext("webgl2"),input=document.getElementById("textarea");let editor;input.value=fsSource;var autoCompile=!1;let gShaderProgram=null,gBuffers=null,gProgramInfo=null,triggerCompilerTimeout=null,compilePromise=null,gUniforms=new Map,uniformsGui={};const guiControllers=new Map;let configGui={aspect_ratio:1.777,width:400,animate:!1,continuousMouse:!0,clearStorage:()=>localStorage.clear(),quickSave:()=>{localStorage.setItem("code",editor.getValue()),SnackBar({status:"success",message:"Saved + Sharing URL copied to clipboard",timeout:3e3})},quickLoad:()=>{const e=localStorage.getItem("code");e?(editor.setValue(e),SnackBar({status:"success",message:"Loaded",timeout:1e3}),compile()):SnackBar({status:"error",message:"No saved code exists",timeout:1e3})}},selectedElem,lastMousePos,animateController,lastTimestamp=null,mouse={x:0,y:0},mouseControllers=[],sizeControllers=[],gui=new dat.GUI;function initBuffers(e){const n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);return e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW),{position:n}}function createTexture(e){const n=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,n),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,e),n}function initShaderProgram(e,n,t,o){const a=loadShader(e,e.VERTEX_SHADER,n,o);if(null==a)return null;const i=loadShader(e,e.FRAGMENT_SHADER,t,o);if(null==i)return e.deleteShader(a),null;const r=e.createProgram();return e.attachShader(r,a),e.attachShader(r,i),e.linkProgram(r),e.deleteShader(a),e.deleteShader(i),e.getProgramParameter(r,e.LINK_STATUS)?r:(console.log("Unable to initialize the shader program: "+e.getProgramInfoLog(r)),e.deleteProgram(r),null)}function unique(e){return[...new Set(e)]}function reportErrorCompilingShader(e,n){unique([...e.matchAll(/0\:\d+/g)].map((e=>e[0]))).forEach((t=>{const o=t.split(":"),a=parseInt(o[1])-n+1;e=e.replaceAll(t,`${o[0]}:${a}`),editor.addLineClass(a-1,"background","redBackground")})),e=e.replaceAll("\n","<br>"),SnackBar({message:e,status:"error",timeout:!1})}function loadShader(e,n,t,o){const a=e.createShader(n);return e.shaderSource(a,t),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)?a:(reportErrorCompilingShader(e.getShaderInfoLog(a),o),e.deleteShader(a),null)}function drawScene(e,n,t,o){n.viewport(0,0,n.canvas.width,n.canvas.height),n.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT);{const e=2,a=n.FLOAT,i=!1,r=0,l=0;n.bindBuffer(n.ARRAY_BUFFER,o.position),n.vertexAttribPointer(t.attribLocations.vertexPosition,e,a,i,r,l),n.enableVertexAttribArray(t.attribLocations.vertexPosition)}n.useProgram(t.program),n.uniform2f(t.uniformLocations.res,e.width,e.height),n.uniform2f(t.uniformLocations.mouse,mouse.x,mouse.y),n.uniform1f(t.uniformLocations.time,parseFloat(timeElem.innerText)),updateUniformValues();{const e=0,t=4;n.drawArrays(n.TRIANGLE_STRIP,e,t)}}async function init(){const e=getUrlParam("code");e&&(input.value=e),configGui.width=canvas.parentElement.parentElement.clientWidth/2,editor=CodeMirror.fromTextArea(document.getElementById("textarea"),{mode:"x-shader/x-fragment",lineNumbers:!0,lineWrapping:!0,extraKeys:{"Ctrl-Space":"autocomplete"},indentUnit:2}),editor.getWrapperElement().style.height="100%",editor.on("change",(()=>{autoCompile&&(triggerCompilerTimeout&&clearTimeout(triggerCompilerTimeout),setTimeout((()=>{compilePromise=compile()}),AUTO_COMPILE_DELAY_MS))})),gBuffers=initBuffers(gl),compilePromise=compile(),await compilePromise,resizeCanvas(),codeElem.style.display="none",controls.style.display="none",localStorage.getItem("help_shown")||SnackBar({message:"Press Alt/Ctrl + H for help",timeout:5e3})}function defaultValueForType(e){switch(e){case"bool":return!1;case"int":case"float":return 0;case"vec2":return[0,0];case"vec3":case"col":return[0,0,0];case"vec4":return[0,0,0,0]}return""}function extractUniforms(){const e=[...editor.getValue().matchAll(autoUniformRegex)],n=new Set(e.map((e=>e[2])));let t=[];[...gUniforms.keys()].filter((e=>!n.has(e))).forEach((e=>{t.push(gUniforms.get(e)),gUniforms.delete(e)})),e.forEach((e=>{gUniforms.has(e[2])&&isSameType(gUniforms.get(e[2]).type,e[1])?isSameType(gUniforms.get(e[2]).type,e[1])&&(gUniforms.get(e[2]).type=e[1]):gUniforms.set(e[2],{type:e[1],value:1==t.length&&isSameType(t[0].type,e[1])?t[0].value:defaultValueForType(e[1])})})),createUniformGui()}function isSameType(e,n){return("col"==e?"vec3":e)==("col"==n?"vec3":n)}function getUniformString(){let e="";return gUniforms.forEach(((n,t)=>{const o="col"==n.type?"vec3":n.type;e+=`uniform ${o} ${t};`})),e}function resizeCanvas(){document.fullscreenElement||(canvas.classList.remove("floatingViewer"),canvas.style.width=`${configGui.width}px`,canvas.style.height=configGui.width/configGui.aspect_ratio+"px");const e=window.devicePixelRatio,n=Math.round(canvas.clientWidth*e),t=Math.round(canvas.clientHeight*e);canvas.width==n&&canvas.height==t||(canvas.width=n,canvas.height=t,gl.viewport(0,0,gl.canvas.width,gl.canvas.height),controls.style.width=`${canvas.clientWidth}px`,onUniformUpdate(),updateCodeEditorType())}function createReconfigGui(){animateController=gui.add(configGui,"animate").onChange((()=>{handleAnimateChange()})),gui.add(window,"autoCompile");const e=gui.addFolder("storage");e.add(configGui,"clearStorage"),e.add(configGui,"quickSave"),e.add(configGui,"quickLoad");const n=gui.addFolder("Sizing");sizeControllers=[],sizeControllers.push(n.add(configGui,"aspect_ratio",void 0,void 0,.01).onChange((()=>resizeCanvas()))),sizeControllers.push(n.add(configGui,"width",200,window.innerWidth).onChange((()=>resizeCanvas())));const t=gui.addFolder("Mouse");t.add(configGui,"continuousMouse"),mouseControllers=[],mouseControllers.push(t.add(mouse,"x",void 0,void 0,5).onChange((()=>onUniformUpdate()))),mouseControllers.push(t.add(mouse,"y",void 0,void 0,5).onChange((()=>onUniformUpdate())))}function createUniformGui(){gui.destroy(),guiControllers.clear(),uniformsGui={},gui=new dat.GUI,createReconfigGui(),gui.hide(),gUniforms.forEach(((e,n)=>{switch(e.type){case"bool":return uniformsGui[n]=e.value,void guiControllers.set(n,gui.add(uniformsGui,n).onChange((()=>{e.value=uniformsGui[n],onUniformUpdate()})));case"int":case"float":return uniformsGui[n]=e.value,void guiControllers.set(n,gui.add(uniformsGui,n,void 0,void 0,.01).onChange((()=>{e.value=uniformsGui[n],onUniformUpdate()})));case"vec2":case"vec3":case"vec4":return uniformsGui[`${n}.x`]=e.value[0],guiControllers.set(n,gui.add(uniformsGui,`${n}.x`,void 0,void 0,.01).onChange((()=>{e.value[0]=uniformsGui[`${n}.x`],onUniformUpdate()}))),uniformsGui[`${n}.y`]=e.value[1],guiControllers.set(n,gui.add(uniformsGui,`${n}.y`,void 0,void 0,.01).onChange((()=>{e.value[1]=uniformsGui[`${n}.y`],onUniformUpdate()}))),"vec2"!=e.type&&(uniformsGui[`${n}.z`]=e.value[2],guiControllers.set(n,gui.add(uniformsGui,`${n}.z`,void 0,void 0,.01).onChange((()=>{e.value[2]=uniformsGui[`${n}.z`],onUniformUpdate()})))),void("vec4"==e.type&&(uniformsGui[`${n}.w`]=e.value[3],guiControllers.set(n,gui.add(uniformsGui,`${n}.w`,void 0,void 0,.01).onChange((()=>{e.value[3]=uniformsGui[`${n}.w`],onUniformUpdate()})))));case"col":uniformsGui[n]=e.value.map((e=>255*e)),guiControllers.set(n,gui.addColor(uniformsGui,n).onChange((()=>{e.value=uniformsGui[n].map((e=>e/255)),onUniformUpdate()})))}}))}function updateUniformValues(){gUniforms.forEach(((e,n)=>{const t=gl.getUniformLocation(gShaderProgram,n);switch(e.type){case"bool":gl.uniform1i(t,e.value);case"int":return void gl.uniform1i(t,e.value);case"float":return void gl.uniform1f(t,e.value);case"vec2":return void gl.uniform2fv(t,e.value);case"vec3":case"col":return void gl.uniform3fv(t,e.value);case"vec4":return void gl.uniform4fv(t,e.value)}}))}function onUniformUpdate(){drawScene(canvas,gl,gProgramInfo,gBuffers)}function clearSnackbars(){[...document.getElementsByClassName("js-snackbar-container")].forEach((e=>{e.getElementsByClassName("js-snackbar--danger").length>0&&e.remove()})),[...Array(editor.lineCount()).keys()].forEach((e=>editor.removeLineClass(e,"background")))}async function compile(){return new Promise(((e,n)=>{clearSnackbars(),extractUniforms();const t=FLOAT_PRECISION+getUniformString(),o=t.split("\n").length,a=t+editor.getValue()+FRAG_SHARDER_SUFFIX,i=initShaderProgram(gl,vsSource,a,o);i?(SnackBar({status:"success",message:"Compiled successfully",timeout:1e3}),e(i)):n("failed")})).then((e=>{compilePromise=null,gl.deleteProgram(gShaderProgram),gShaderProgram=e,gProgramInfo={program:gShaderProgram,attribLocations:{vertexPosition:gl.getAttribLocation(gShaderProgram,"aVertexPosition")},uniformLocations:{res:gl.getUniformLocation(gShaderProgram,"res"),time:gl.getUniformLocation(gShaderProgram,"time"),mouse:gl.getUniformLocation(gShaderProgram,"mouse")}},drawScene(canvas,gl,gProgramInfo,gBuffers)}))}function updateCodeEditorType(){canvas.clientWidth>=.6*canvas.parentElement.parentElement.clientWidth?codeElem.classList.add("floatingEditor"):codeElem.classList.remove("floatingEditor")}function getUrlWithoutParams(){return location.protocol+"//"+location.host+location.pathname}function getUrlParam(e){return new URLSearchParams(window.location.search).get(e)}function insertUniform(e){const n=gUniforms.get(e),t=`/*${n.type}*/${e}`,o=editor.getSearchCursor(t);if(!o.find())return;let a=n.value;Array.isArray(a)?a=`vec${a.length}(${a.map((e=>e.toFixed(3))).join(",")})`:"float"==n.type&&String(a).indexOf(".")<0&&(a=a.toFixed(1)),o.replace(String(a),t),compile()}function extractUniform(e){const n=addVariableWithType(e);editor.replaceSelection(`/*${e.type}*/${n}`),compile()}function addVariableWithType(e){for(let n=0;n<100;n++){const t=`${e.type}_var_${n}`;if(!gUniforms.has(t))return gUniforms.set(t,{type:e.type,value:e.val}),t}return""}function inferVariableTypeAndValue(e){let n=[],t="";return(e=e.trim()).startsWith("vec2")?(n=[...e.matchAll(vec2Vals)][0]?.slice(1)?.map((e=>parseFloat(e))),t="vec2"):e.startsWith("vec3")?(n=[...e.matchAll(vec3Vals)][0]?.slice(1)?.map((e=>parseFloat(e))),t="vec3"):e.startsWith("vec4")?(n=[...e.matchAll(vec4Vals)][0]?.slice(1)?.map((e=>parseFloat(e))),t="vec4"):e.indexOf(".")>=0?(n=parseFloat(e),t="float"):"false"==e||"true"==e?(n="true"==e,t="bool"):(n=parseInt(e),t="int"),n?{type:t,val:n}:{type:""}}function handleAnimateChange(){configGui.animate&&requestAnimationFrame(animate)}function animate(e){if(lastTimestamp){const n=e-lastTimestamp;let t=parseFloat(timeElem.innerText);t+=n/1e3,timeElem.innerText=t.toFixed(3)}onUniformUpdate(),configGui.animate?(lastTimestamp=e,lastFpsTimestamp||(lastFpsTimestamp=e),requestAnimationFrame(animate)):(lastTimestamp=null,lastFpsTimestamp=null)}function mix(e,n,t){return Array.isArray(e)?e.map(((e,o)=>e*(1-t)+n[o]*t)):e*(1-t)+n*t}function linstep(e,n,t){return Math.max(0,Math.min(1,(t-e)/(n-e)))}function smoothstep(e,n,t){const o=linstep(e,n,t);return o*o*(3-2*o)}function expEaseOut(e,n,t){const o=linstep(e,n,t);return 1===o?1:1-Math.pow(2,-10*o)}function interpolate(e,n,t=1e3,o=expEaseOut){let a,i,r=gUniforms.get(e).value;Array.isArray(r)&&(r=[...r]);const l=s=>{if(void 0===a&&(a=s,i=a+t),s<i){let t=mix(r,n,o(a,i,s));gUniforms.get(e).value=t,requestAnimationFrame(l)}else gUniforms.get(e).value=n,createUniformGui();onUniformUpdate()};requestAnimationFrame(l)}init(),timeElem.addEventListener("mousedown",(e=>{selectedElem=timeElem,timeElem.requestPointerLock()})),canvas.addEventListener("mousedown",(e=>{selectedElem=canvas,configGui.continuousMouse&&canvas.requestPointerLock()})),canvas.addEventListener("mousemove",(e=>{if(selectedElem==canvas){if(configGui.continuousMouse)if(e.metaKey||e.altKey){configGui.width+=e.movementX*(e.shiftKey?10:1);const n=canvas.clientHeight-e.movementY*(e.shiftKey?10:1);configGui.aspect_ratio=configGui.width/n,sizeControllers.forEach((e=>e.updateDisplay())),resizeCanvas()}else mouse.x-=e.movementX*(e.shiftKey?10:1),mouse.y-=e.movementY*(e.shiftKey?10:1),mouseControllers.forEach((e=>e.updateDisplay()));else mouse={x:e.offsetX*canvas.width/canvas.clientWidth,y:(canvas.clientHeight-e.offsetY)*canvas.height/canvas.clientHeight};onUniformUpdate()}})),timeElem.addEventListener("focusout",(()=>{0!=timeElem.innerText.length&&"."!=timeElem.innerText||(timeElem.innerText="0.00"),onUniformUpdate()})),timeElem.onkeypress=e=>{let n=String.fromCharCode(e.keyCode);window.getSelection().getRangeAt(0).startOffset;const t=timeElem.innerText.search(/\./);(!/[0-9]|\./.test(n)||"."==n&&t>=0)&&e.preventDefault()},timeElem.oninput=()=>{onUniformUpdate()},window.addEventListener("mousemove",(e=>{if(selectedElem===timeElem){let n=parseFloat(timeElem.innerText);n-=(e.movementY-e.movementX)/(e.shiftKey?10:100),timeElem.innerText=n.toFixed(3),onUniformUpdate()}return!0})),window.addEventListener("resize",(e=>{resizeCanvas()})),window.addEventListener("mouseup",(e=>{selectedElem=null,document.exitPointerLock()})),window.addEventListener("keydown",(e=>{if("Backquote"!=e.code||e.ctrlKey)if("Backquote"==e.code&&e.ctrlKey)"none"==commandElem.style.display?(commandElem.style.display="",commandElem.focus()):(commandElem.style.display="none",commandElem.value=""),e.preventDefault();else if("Digit1"==e.code&&(e.metaKey||e.ctrlKey))"none"==gui.domElement.style.display?gui.show():gui.hide(),e.preventDefault();else if("Digit2"==e.code&&(e.metaKey||e.ctrlKey))"none"==controls.style.display?controls.style.display="flex":controls.style.display="none",e.preventDefault();else if("Enter"==e.code&&(e.metaKey||e.altKey||e.ctrlKey))compilePromise=compile(),e.preventDefault();else if("KeyF"==e.code&&e.altKey)document.fullscreenElement?document.exitFullscreen():(codeElem.style.display="none",canvas.style.width="",canvas.style.height="",canvas.classList.add("floatingViewer"),document.documentElement.requestFullscreen()),e.preventDefault();else if("ArrowUp"==e.code&&e.altKey)animateController.setValue(!configGui.animate);else if("ArrowDown"==e.code&&e.altKey)timeElem.innerText="0.000",onUniformUpdate();else if("KeyE"==e.code&&(e.metaKey||e.ctrlKey)){e.preventDefault();const n=editor.getSelection(),t=inferVariableTypeAndValue(n);""!=t.type?extractUniform(t):gUniforms.has(n)&&insertUniform(n)}else if("KeyS"==e.code&&(e.metaKey||e.ctrlKey)){e.preventDefault(),configGui.quickSave();const n=new URLSearchParams;n.set("code",editor.getValue()),navigator.clipboard.writeText(`${getUrlWithoutParams()}?${n.toString()}`)}else"KeyO"==e.code&&(e.metaKey||e.ctrlKey)?(e.preventDefault(),configGui.quickLoad()):"KeyH"==e.code&&(e.ctrlKey||e.altKey)&&(dialogElement.showModal(),localStorage.setItem("help_shown",!0));else"none"==codeElem.style.display?(codeElem.style.display="flex",updateCodeEditorType()):codeElem.style.display="none",e.preventDefault()})),commandElem.addEventListener("keydown",(event=>{if("Enter"==event.code){let execStr=commandElem.value,guiVar=[...commandElem.value.matchAll(assignmentRegex)];if(1==guiVar.length&&gUniforms.has(guiVar[0][1])){const e=execStr.substr(guiVar[0][0].length);execStr=`interpolate('${guiVar[0][1]}', ${e});`,console.info(execStr)}try{let result=eval(execStr);SnackBar({status:"success",message:result,timeout:1e3})}catch(e){return void SnackBar({status:"error",message:e,timeout:3e3})}commandElem.style.display="none",commandElem.value=""}})),canvas.ondragover=e=>{e.preventDefault()},canvas.ondrop=e=>{if(e.preventDefault(),e.dataTransfer.items)for(var n=0;n<e.dataTransfer.items.length;n++)if("file"==e.dataTransfer.items[n].kind){var t=e.dataTransfer.items[n].getAsFile();createImageBitmap(t).then((e=>{}))}};</script></html>